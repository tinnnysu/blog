Pelco-D协议
===============

:date: 2015-01-04 15:30
:modified: 2015-01-06 14:40
:tags: Pelco
:category: 控制协议
:slug: pelco-d-procotol
:authors: htstudios
:summary: Peloc-D 协议内容

手册内容
-------------

本手册内容涵盖“D”协议。这个协议被用于矩阵开关系统和收发器。

D协议
-------------

信息格式：

+----------+----------+----------+----------+----------+----------+----------+
|  字节1   |  字节2   |  字节3   |  字节4   |  字节5   |  字节6   |  字节7   |
+----------+----------+----------+----------+----------+----------+----------+
| 同步字节 |   地址   |  命令1   |  命令2   |  数据1   |  数据2   |  校验值  |
+----------+----------+----------+----------+----------+----------+----------+

| 以下所有数值都是16进制数字。
| 同步字节都是$FF。
| 地址是收发器的逻辑地址。
| 校验值是消息中有效信息（字节2到字节6）的8位（模256）和。

标准命令
-------------

**标准命令能够多条命令一起发送**

命令1、命令2格式如下所示：

+-------+--------+--------+--------+---------------+-------------+--------+--------+--------+
|       |  位7   |  位6   |   位5  |      位4      |    位3      |  位2   |  位1   |  位0   |
+-------+--------+--------+--------+---------------+-------------+--------+--------+--------+
| 命令1 |  触发  |  保留  |  保留  | 自动/手动扫描 | 摄像机开/关 | 光圈关 | 光圈开 | 聚焦近 |
+-------+--------+--------+--------+---------------+-------------+--------+--------+--------+
| 命令2 | 聚焦远 | 宽视场 | 窄视场 |     向下      |    向上     |  向左  |  向右  |   0    |
+-------+--------+--------+--------+---------------+-------------+--------+--------+--------+

| 触发位（命令1位7）决定位4、位3的意义，如果触发位使能并且位4、位3全部使能，命令将是启动自动扫描并打开摄像机。如果触发位关闭并且位4、位3全部使能，命令将是启动手动扫描并且关闭摄像机。当然，如果位4、位3全部关闭命令将是不采取任何动作。
| 保留位（位6、位5）应当被设成0。
| 字节5包含水平速度。水平速度值在$00（停止）和$3F（高速）之间，$FF表示最快速度，最快速度是指设备所能达到的速度上限。$FF单独考虑是因为在高速和最快速度之间往往不是一个平滑的步进。这就是说，通常从一个速度等级过渡到另一个速度等级的过程是平滑的，因而当切换进出最快速度时需要提供一个的平滑过渡过程。
| 字节6包含俯仰速度。俯仰速度值在$00（停止）和$3F（高速）之间。
| 字节7是校验值，校验值是除了同步字节之外字节以256为模的和。

扩展命令
----------------

**扩展命令只能单条发送**

除了以上所描述的“PZT”命令外，还有一些其他命令允许你控制设备的一些高级特性。


扩展命令：

+------------------------+-------+-------+-------------+-----------+
| 命令                   | 字3   | 字4   | 字5         | 字6       |
+------------------------+-------+-------+-------------+-----------+
| 设置预置位             | 00    | 03    | 00          | 01到20    |
+------------------------+-------+-------+-------------+-----------+
| 清除预置位             | 00    | 05    | 00          | 01到20    |
+------------------------+-------+-------+-------------+-----------+
| 调用预置位             | 00    | 07    | 00          | 01到20    |
+------------------------+-------+-------+-------------+-----------+
| 反转                   | 00    | 07    | 00          | 21        |
+------------------------+-------+-------+-------------+-----------+
| 调用水平0位            | 00    | 07    | 00          | 22        |
+------------------------+-------+-------+-------------+-----------+
| 设置辅助位             | 00    | 09    | 00          | 01到08    |
+------------------------+-------+-------+-------------+-----------+
| 清除辅助位             | 00    | 0B    | 00          | 01到08    |
+------------------------+-------+-------+-------------+-----------+
| 远程复位               | 00    | 0F    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 设置区域起始           | 00    | 11    | 00          | 01到08    |
+------------------------+-------+-------+-------------+-----------+
| 设置区域结束           | 00    | 13    | 00          | 01到08    |
+------------------------+-------+-------+-------------+-----------+
| 显示字符               | 00    | 15    | X位置00到28 | ASCII值   |
+------------------------+-------+-------+-------------+-----------+
| 清除屏幕               | 00    | 17    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 报警确认               | 00    | 19    | 00          | 报警号    |
+------------------------+-------+-------+-------------+-----------+
| 区域扫描打开           | 00    | 1B    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 区域扫描关闭           | 00    | 1D    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 设置模式起始           | 00    | 1F    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 设置模式结束           | 00    | 21    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 运行模式               | 00    | 23    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 设置变倍速度           | 00    | 25    | 00          | 00到03    |
+------------------------+-------+-------+-------------+-----------+
| 设置聚焦速度           | 00    | 27    | 00          | 00到03    |
+------------------------+-------+-------+-------------+-----------+
| 复位摄像机             | 00    | 29    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 自动聚焦自动/打开/关闭 | 00    | 2B    | 00          | 00-02     |
+------------------------+-------+-------+-------------+-----------+
| 自动光圈自动/打开/关闭 | 00    | 2D    | 00          | 00-02     |
+------------------------+-------+-------+-------------+-----------+
| 增益自动/打开/关闭     | 00    | 2F    | 00          | 00-02     |
+------------------------+-------+-------+-------------+-----------+
| 背光补偿打开/关闭      | 00    | 31    | 00          | 01-02     |
+------------------------+-------+-------+-------------+-----------+
| 自动白平衡打开/关闭    | 00    | 33    | 00          | 01-02     |
+------------------------+-------+-------+-------------+-----------+ 
| 启用设备相位延迟模式   | 00    | 35    | 00          | 00        |
+------------------------+-------+-------+-------------+-----------+
| 设置快门速度           | 00    | 37    | 无限制      | 无限制    |
+------------------------+-------+-------+-------------+-----------+
| 调整线锁定相位延迟     | 00-01 | 39    | 无限制      | 无限制    |
+------------------------+-------+-------+-------------+-----------+
| 调整白平衡（R-B）      | 00-01 | 3B    | 无限制      | 无限制    | 
+------------------------+-------+-------+-------------+-----------+
| 调整白平衡（M-G）      | 00-01 | 3D    | 无限制      | 无限制    |
+------------------------+-------+-------+-------------+-----------+
| 调整增益               | 00-01 | 3F    | 无限制      | 无限制    |
+------------------------+-------+-------+-------------+-----------+
| 调整自动光圈等级       | 00-01 | 41    | 无限制      | 无限制    | 
+------------------------+-------+-------+-------------+-----------+
| 调整自动光圈峰值       | 00-01 | 43    | 无限制      | 无限制    |
+------------------------+-------+-------+-------------+-----------+
| 查询                   | 00    | 45    | 无限制      | 无限制    |
+------------------------+-------+-------+-------------+-----------+

**注意：查询命令只能用在点对点应用上，一个被查询的设备会把响应信息发送到其他所有地址。因此，如果一个以上的设备发送该命令，将会有多个设备在同一时间传输信息**

命令响应分为4部分，第一部分是同步字节（FF），第二部分是接收器地址，第三部分是告警信息，第四部分是校验值。

创建标签
---------------

很多设备都有在视频上显示标签的能力。标签一般用来确认预置位或即将被扫描的区域。有一种方法用来
建立标签与预置位活区域的关联。第一步，使用 ``显示字符`` 命令发送标签到接收器，然后当字符显示
完毕后设置预置位。这样就能够将标签与预置位关联。

消息示例
---------------

(所有信息值都是16进制的)

+--------------------------------------------+----------------------------+
| 消息                                       | 格式                       |
+--------------------------------------------+----------------------------+
| 接收器1，摄像机开                          | FF, 01, 88, 00, 00, 00, 89 |
+--------------------------------------------+----------------------------+
| 接收器1，摄像机关                          | FF, 01, 08, 00, 00, 00, 09 |
+--------------------------------------------+----------------------------+
| 接收器2，向左，1/2速度                     | FF, 02, 00, 04, 00, 20, 02 |
+--------------------------------------------+----------------------------+
| 接收器2，停止                              | FF, 02, 00, 00, 00, 00, 02 |
+--------------------------------------------+----------------------------+
| 接收器10，摄像机开，聚焦远，向下，最高速度 | FF, 0A, 88, 90, 00, 40, 62 |
+--------------------------------------------+----------------------------+

原文最后一个命令示例可能有错误!!!

| 0A           00001010
| 88           10001000
| 和           10010010  92
| 90           10010000
| 和           00100010  22 （以256为模，舍去高位）
| 00           00000000
| 和           00100010  22
| 40           01000000
| 和           01100010  62 （最终校验和）

响应信息
---------------

接收“D”协议的设备可能会生成一个响应信息

响应信息的通常格式：

+----------+------+----------+--------+
| 同步字节 | 地址 | 告警信息 | 校验值 |
+----------+------+----------+--------+

告警信息为1个字节，格式如下：

+-------+-------+-------+-------+-------+-------+-------+-------+
| 位7   | 位6   | 位5   | 位4   | 位3   | 位2   | 位1   | 位0   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 告警8 | 告警7 | 告警6 | 告警5 | 告警4 | 告警3 | 告警2 | 告警1 |
+-------+-------+-------+-------+-------+-------+-------+-------+

| 如果相应位打开（1）告警信息激活，如果相应位关闭（0）告警信息未激活
| 校验值是所接收命令的校验值与告警信息的和

查询命令的响应信息：

+----------+------+--------------------+--------+
| 同步字节 | 地址 | 部件序号（15字节） | 校验值 |
+----------+------+--------------------+--------+

| 地址是发送查询命令设备的地址
| 部件序号是ASCII字符串，包含被查询设备的程序序号
| 校验值是相应查询命令校验值，响应信息地址，15字节部件序号的8位和

