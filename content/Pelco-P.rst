Pelco-P协议
##############

:date: 2015-01-07 14:28
:modified: 2015-01-09 11:13
:tags: Pelco-P, Pelco
:category: 控制协议
:slug: pelco-p-protocol
:authors: htstudios
:summary: Pelco-P

手册内容
----------------

本手册介绍Pelco-P协议，本协议采用无奇偶校验，一个起始位，一个结束位。推荐波特率为
4800（4800，8，N，1，1）。

消息格式
----------------

+------+----------+-----------------+
| 字节 | 数据值   | 功能            |
+------+----------+-----------------+
| 1    | $A0      | STX（开始传输） |
+------+----------+-----------------+
| 2    | $00到$1F | 地址            |
+------+----------+-----------------+
| 3    | 数据字1  | 参见下文        |
+------+----------+-----------------+
| 4    | 数据字2  | 参见下文        |
+------+----------+-----------------+
| 5    | 数据字3  | 参见下文        |
+------+----------+-----------------+
| 6    | 数据字4  | 参见下文        |
+------+----------+-----------------+
| 7    | $AF      | ETX（结束传输） |
+------+----------+-----------------+
| 8    | $00到$FF | 校验值          |
+------+----------+-----------------+

| 字节1总是$A0
| 字节2是接收器地址，由接收器编码开关编码
| 字节3-6功能参见下文
| 字节7总是$AF
| 字节8是字节1-7的异或和（XOR）

本协议是以0开始的，所以在本协议中第一个接收器的地址是$00,代表地址1

数据字主要分为两个部分。第一部分是直水平俯仰命令，各个功能如下定义：

水平俯仰命令
------------------

+---------+---------------------------------------------------------------------------------------+
|         | 数据位                                                                                |
+         +-----+----------+------------+------------+----------+----------+--------+-------------+
|         | 7   | 6        | 5          | 4          | 3        | 2        | 1      | 0           |
+---------+-----+----------+------------+------------+----------+----------+--------+-------------+
| 数据字1 | 0   | 摄像机开 | 自动扫描开 | 摄像机开关 | 光圈关闭 | 光圈打开 | 聚焦近 | 聚焦远      |
+---------+-----+----------+------------+------------+----------+----------+--------+-------------+
| 数据字2 | 0   | 变倍近   | 变倍远     | 垂直上     | 垂直下   | 水平左   | 水平右 | 0(命令类别) |
+---------+-----+----------+------------+------------+----------+----------+--------+-------------+
| 数据字3 | 水平速度$00到$3F，$40代表最高速度                                                     |
+---------+---------------------------------------------------------------------------------------+
| 数据字4 | 俯仰速度$00到$3F                                                                      |
+---------+---------------------------------------------------------------------------------------+

扩展命令
------------------

扩展命令集使用数据字2的位0（1），格式如下表所示：

+--------------+---------+---------+---------+---------+
| 命令         | 数据字1 | 数据字2 | 数据字3 | 数据字4 |
+--------------+---------+---------+---------+---------+
| 设置预置位XX | 00      | 03      | 00      | 01到FF  |
+--------------+---------+---------+---------+---------+
| 清除预置位XX | 00      | 05      | 00      | 01到FF  |
+--------------+---------+---------+---------+---------+
| 调用预置位XX | 00      | 07      | 00      | 01到FF  |
+--------------+---------+---------+---------+---------+
| 反转(180度)  | 00      | 07      | 00      | 21      |
+--------------+---------+---------+---------+---------+
| 0位          | 00      | 07      | 00      | 22      |
+--------------+---------+---------+---------+---------+
| 自动扫描     | 00      | 09      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 自动扫描停止 | 00      | 0B      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 远程复位     | 00      | 0F      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 区域开始     | 00      | 11      | 00      | 01到08  |
+--------------+---------+---------+---------+---------+
| 区域结束     | 00      | 13      | 00      | 01到08  |
+--------------+---------+---------+---------+---------+
| 显示字符     | 00      | 15      | 00到28  | 00到7F  |
+--------------+---------+---------+---------+---------+
| 清空屏幕     | 00      | 17      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 告警确认     | 00      | 19      | 00      | 01到08  |
+--------------+---------+---------+---------+---------+
| 区域扫描打开 | 00      | 1B      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 区域扫描停止 | 00      | 1D      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 模式打开     | 00      | 1F      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 模式关闭     | 00      | 21      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 运行模式     | 00      | 23      | 00      | 00      |
+--------------+---------+---------+---------+---------+
| 变倍镜头速度 | 00      | 25      | 00      | 00到03  |
+--------------+---------+---------+---------+---------+
| 聚焦镜头速度 | 00      | 27      | 00      | 00到03  |
+--------------+---------+---------+---------+---------+

接收器会响应一个ACK信息。

为了适应新系统和兼容旧系统，通过使用一些未使用的预置位功能添加了一些新功能。
如下表所示:

+----------+----------------------------+
| 预置位号 | 功能                       |
+----------+----------------------------+
| 99       | 开始自动扫描               |
+----------+----------------------------+
| 98       | 开始帧扫描                 |
+----------+----------------------------+
| 97       | 开始随机扫描               |
+----------+----------------------------+
| 96       | 停止扫描                   |
+----------+----------------------------+
| 95       | 进入菜单模式               |
+----------+----------------------------+
| 94       | 远程复位                   |
+----------+----------------------------+
| 93       | 设置右向停止限定           |
+----------+----------------------------+
| 92       | 设置左向停止限定           |
+----------+----------------------------+
| 34       | 0位                        |
+----------+----------------------------+
| 33       | 反转                       |
+----------+----------------------------+

示例：

设置地址为1的接收器32号预置位：

A0 00 00 03 00 20 AF 2C

驱动地址为2的接收器1/2速度左转:

A0 01 00 04 00 1F AF 15
